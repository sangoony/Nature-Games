<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ù…Ø¯Ù„ Ø­Ø§Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ø±ØªØ¹ÛŒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .game-area {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .states-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
        }
        
        .state-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .state-box {
            flex: 1;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }
        
        .state-excellent {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }
        
        .state-good {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
        }
        
        .state-moderate {
            background: linear-gradient(135deg, #f2994a 0%, #f2c94c 100%);
            color: white;
        }
        
        .state-poor {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
            color: white;
        }
        
        .state-destroyed {
            background: linear-gradient(135deg, #000000 0%, #434343 100%);
            color: white;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .state-box.active {
            border-color: #2c3e50;
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        
        .transition-arrow {
            text-align: center;
            font-size: 24px;
            color: #95a5a6;
            margin: 5px 0;
        }
        
        .transition-phase {
            font-size: 12px;
            color: #7f8c8d;
            font-style: italic;
        }
        
        .controls-panel {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 15px;
        }
        
        .control-section {
            margin-bottom: 20px;
        }
        
        .control-section h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .control-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .control-item label {
            font-size: 14px;
            color: #34495e;
        }
        
        .control-item select {
            padding: 5px 10px;
            border-radius: 5px;
            border: 2px solid #bdc3c7;
            background: white;
            cursor: pointer;
        }
        
        .score-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .score-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .score-value {
            font-weight: bold;
            font-size: 16px;
        }
        
        .positive {
            color: #2ecc71;
        }
        
        .negative {
            color: #e74c3c;
        }
        
        .info-panel {
            background: #3498db;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }
        
        .event-log {
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 150px;
            overflow-y: auto;
            font-size: 13px;
        }
        
        .event-item {
            margin-bottom: 8px;
            padding: 5px;
            border-left: 3px solid #3498db;
            padding-right: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c 0%, #f39c12 25%, #f1c40f 50%, #2ecc71 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        button#advance-year {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        
        button#advance-year:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div style="position: fixed; top: 20px; right: 20px; z-index: 10000;">
        <button onclick="window.location.href='ecology_menu.html'" 
                style="background: white; border: 2px solid #667eea; padding: 12px 24px; 
                       border-radius: 10px; font-size: 16px; font-family: Tahoma; 
                       cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                       transition: all 0.3s ease;">
            â† Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ú©ÙˆÙ„ÙˆÚ˜ÛŒ
        </button>
    </div>
    
    <div class="container">
        <h1>ğŸŒ± Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ù…Ø¯Ù„ Ø­Ø§Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ú©ÙˆØ³ÛŒØ³ØªÙ… Ù…Ø±ØªØ¹ÛŒ ğŸŒ±</h1>
        
        <div class="game-area">
            <div class="states-container">
                <h2 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">ÙˆØ¶Ø¹ÛŒØª Ø§Ú©ÙˆØ³ÛŒØ³ØªÙ…</h2>
                
                <div class="state-row">
                    <div class="state-box state-excellent" id="state-excellent">
                        Ø¹Ø§Ù„ÛŒ
                        <div style="font-size: 12px; margin-top: 5px;">ØªÙ†ÙˆØ¹ Ø¨Ø§Ù„Ø§ØŒ Ù¾ÙˆØ´Ø´ Ú©Ø§Ù…Ù„</div>
                    </div>
                </div>
                
                <div class="transition-arrow">â†•ï¸ <span class="transition-phase">Ø¢Ø³ØªØ§Ù†Ù‡: 200 Ø§Ù…ØªÛŒØ§Ø²</span></div>
                
                <div class="state-row">
                    <div class="state-box state-good" id="state-good">
                        Ø®ÙˆØ¨
                        <div style="font-size: 12px; margin-top: 5px;">Ú¯ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø·Ù„ÙˆØ¨ ØºØ§Ù„Ø¨</div>
                    </div>
                </div>
                
                <div class="transition-arrow">â†•ï¸ <span class="transition-phase">Ø¢Ø³ØªØ§Ù†Ù‡: 100 Ø§Ù…ØªÛŒØ§Ø²</span></div>
                
                <div class="state-row">
                    <div class="state-box state-moderate" id="state-moderate">
                        Ù…ØªÙˆØ³Ø·
                        <div style="font-size: 12px; margin-top: 5px;">Ú©Ø§Ù‡Ø´ ØªÙ†ÙˆØ¹ØŒ ÙØ±Ø³Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒ</div>
                    </div>
                </div>
                
                <div class="transition-arrow">â†•ï¸ <span class="transition-phase">Ø¢Ø³ØªØ§Ù†Ù‡: 50 Ø§Ù…ØªÛŒØ§Ø²</span></div>
                
                <div class="state-row">
                    <div class="state-box state-poor" id="state-poor">
                        ÙÙ‚ÛŒØ±
                        <div style="font-size: 12px; margin-top: 5px;">ØªØ®Ø±ÛŒØ¨ Ø´Ø¯ÛŒØ¯ØŒ Ø®Ø§Ú© Ù„Ø®Øª</div>
                    </div>
                </div>
                
                <div class="transition-arrow">â†•ï¸ <span class="transition-phase">Ø¢Ø³ØªØ§Ù†Ù‡: -100 Ø§Ù…ØªÛŒØ§Ø²</span></div>
                
                <div class="state-row">
                    <div class="state-box state-destroyed" id="state-destroyed">
                        ğŸ’€ ØªØ®Ø±ÛŒØ¨ Ø³Ø±Ø²Ù…ÛŒÙ†
                        <div style="font-size: 12px; margin-top: 5px;">ÙØ±ÙˆÙ¾Ø§Ø´ÛŒ Ú©Ø§Ù…Ù„ Ø§Ú©ÙˆØ³ÛŒØ³ØªÙ…</div>
                    </div>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 50%;">
                        Ù…ØªÙˆØ³Ø·
                    </div>
                </div>
            </div>
            
            <div class="controls-panel">
                <div class="score-display">
                    <div class="score-item">
                        <span>ğŸ’ Ø§Ù…ØªÛŒØ§Ø² ØªØ¬Ù…Ø¹ÛŒ Ø³ÛŒØ³ØªÙ…:</span>
                        <span class="score-value" id="accumulated-score" style="font-size: 20px;">50</span>
                    </div>
                    <div style="border-top: 1px solid rgba(255,255,255,0.3); margin: 10px 0; padding-top: 10px;">
                        <div class="score-item">
                            <span>ğŸŒ± Ø¹ÙˆØ§Ù…Ù„ Ù…Ø«Ø¨Øª:</span>
                            <span class="score-value positive" id="positive-score">+8</span>
                        </div>
                        <div class="score-item">
                            <span>âš ï¸ Ø¹ÙˆØ§Ù…Ù„ Ù…Ù†ÙÛŒ:</span>
                            <span class="score-value negative" id="negative-score">-3</span>
                        </div>
                        <div class="score-item">
                            <span>ğŸ“Š Ø®Ø§Ù„Øµ Ø§ÛŒÙ† Ø³Ø§Ù„:</span>
                            <span class="score-value" id="total-score">+5</span>
                        </div>
                    </div>
                </div>
                
                <button id="advance-year">â­ï¸ Ù¾ÛŒØ´Ø±ÙˆÛŒ ÛŒÚ© Ø³Ø§Ù„</button>
                
                <div class="control-section">
                    <h3>ğŸ“Š Ø¹ÙˆØ§Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ú©Ù†ØªØ±Ù„</h3>
                    <div class="control-item">
                        <label>ğŸŒ¦ï¸ ÙˆØ¶Ø¹ÛŒØª Ø§Ù‚Ù„ÛŒÙ…ÛŒ:</label>
                        <span id="climate-status">Ù…ØªØ¹Ø§Ø¯Ù„ (0)</span>
                    </div>
                    <div class="control-item">
                        <label>ğŸ”¥ Ø®Ø·Ø± Ø¢ØªØ´â€ŒØ³ÙˆØ²ÛŒ:</label>
                        <span id="fire-status">Ù†Ø¯Ø§Ø±Ø¯ (0)</span>
                    </div>
                    <div class="control-item">
                        <label>ğŸ¦  Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§:</label>
                        <span id="disease-status">Ù†Ø¯Ø§Ø±Ø¯ (0)</span>
                    </div>
                    <div class="control-item">
                        <label>ğŸ’° Ø¨Ø­Ø±Ø§Ù† Ø§Ù‚ØªØµØ§Ø¯ÛŒ:</label>
                        <span id="economic-status">Ù†Ø¯Ø§Ø±Ø¯ (0)</span>
                    </div>
                    <div class="control-item">
                        <label>ğŸŒ¿ Ù†ÛŒØ±ÙˆÛŒ Ø°Ø§ØªÛŒ ØªÙˆØ§Ù„ÛŒ:</label>
                        <span style="color: #2ecc71; font-weight: bold;">+3</span>
                    </div>
                </div>
                
                <div class="control-section">
                    <h3>ğŸ® Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ Ø´Ù…Ø§</h3>
                    <div class="control-item">
                        <label>ğŸ„ Ø´Ø¯Øª Ú†Ø±Ø§:</label>
                        <select id="grazing-intensity">
                            <option value="3">Ø­ÙØ§Ø¸Øª Ú©Ø§Ù…Ù„ (+3)</option>
                            <option value="2">Ú†Ø±Ø§ÛŒ Ø³Ø¨Ú© (+2)</option>
                            <option value="0" selected>Ú†Ø±Ø§ÛŒ Ù…ØªØ¹Ø§Ø¯Ù„ (0)</option>
                            <option value="-3">Ú†Ø±Ø§ÛŒ Ù…ØªÙˆØ³Ø· (-3)</option>
                            <option value="-6">Ú†Ø±Ø§ÛŒ Ø³Ù†Ú¯ÛŒÙ† (-6)</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>ğŸ’§ Ù…Ø¯ÛŒØ±ÛŒØª ØµØ­ÛŒØ­ Ø§Ø±Ø§Ø¶ÛŒ:</label>
                        <select id="land-management">
                            <option value="2">Ø¹Ø§Ù„ÛŒ (+2)</option>
                            <option value="1">Ø®ÙˆØ¨ (+1)</option>
                            <option value="0" selected>Ù…ØªÙˆØ³Ø· (0)</option>
                            <option value="-2">Ø¶Ø¹ÛŒÙ (-2)</option>
                            <option value="-5">Ø¨Ø³ÛŒØ§Ø± Ø¶Ø¹ÛŒÙ (-5)</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>ğŸŒ± Ù…Ø¯ÛŒØ±ÛŒØª Ø²ÛŒØ³ØªÛŒ Ø§Ú©ÙˆØ³ÛŒØ³ØªÙ…:</label>
                        <select id="bio-management">
                            <option value="6">Ø§Ø­ÛŒØ§ÛŒ Ø¬Ø§Ù…Ø¹ (+6)</option>
                            <option value="4">Ú©Ø§Ø´Øª ÙØ¹Ø§Ù„ (+4)</option>
                            <option value="2">Ø¨Ø°Ø±Ù¾Ø§Ø´ÛŒ (+2)</option>
                            <option value="0" selected>Ø¨Ø¯ÙˆÙ† Ø§Ù‚Ø¯Ø§Ù… (0)</option>
                            <option value="-3">Ù…Ø¯Ø§Ø®Ù„Ù‡ Ù…Ø®Ø±Ø¨ (-3)</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>ğŸ›¡ï¸ Ø­ÙØ§Ø¸Øª Ø®Ø§Ú©:</label>
                        <select id="soil-protection">
                            <option value="5">Ø­ÙØ§Ø¸Øª Ú©Ø§Ù…Ù„ (+5)</option>
                            <option value="3">Ø³Ø§Ø²Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ØªØ¹Ø¯Ø¯ (+3)</option>
                            <option value="1">Ø³Ø§Ø²Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø§Ú©Ù†Ø¯Ù‡ (+1)</option>
                            <option value="0" selected>Ø¨Ø¯ÙˆÙ† Ø³Ø§Ø²Ù‡ (0)</option>
                            <option value="-3">Ø¹Ø¯Ù… Ú©Ù†ØªØ±Ù„ (-3)</option>
                            <option value="-7">ØªØ®Ø±ÛŒØ¨ ÙØ¹Ø§Ù„ (-7)</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ø¬ÙˆØ§Ù…Ø¹ Ù…Ø­Ù„ÛŒ:</label>
                        <select id="community-management">
                            <option value="5">Ù…Ø´Ø§Ø±Ú©Øª Ú©Ø§Ù…Ù„ (+5)</option>
                            <option value="3">Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø®ÙˆØ¨ (+3)</option>
                            <option value="1">Ø§Ø±ØªØ¨Ø§Ø· Ø¶Ø¹ÛŒÙ (+1)</option>
                            <option value="0" selected>Ø¨Ø¯ÙˆÙ† Ø§Ø±ØªØ¨Ø§Ø· (0)</option>
                            <option value="-3">ØªÙ†Ø´ Ø¬Ø²Ø¦ÛŒ (-3)</option>
                            <option value="-5">ØªØ¹Ø§Ø±Ø¶ Ø´Ø¯ÛŒØ¯ (-5)</option>
                            <option value="-8">Ø¯Ø±Ú¯ÛŒØ±ÛŒ (-8)</option>
                        </select>
                    </div>
                </div>
                
                <div class="info-panel">
                    <strong>ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ:</strong>
                    <div id="current-state-text" style="font-size: 20px; margin-top: 5px;">Ù…ØªÙˆØ³Ø·</div>
                    <div id="transition-info" style="margin-top: 10px; font-size: 13px;">
                        Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ù†ØªÙ‚Ø§Ù„
                    </div>
                </div>
            </div>
        </div>
        
        <div class="event-log" id="event-log">
            <div class="event-item">ğŸ® Ø¨Ø§Ø²ÛŒ Ø¢ØºØ§Ø² Ø´Ø¯</div>
        </div>
    </div>

    <script>
        // ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ
        const game = {
            year: 0,
            score: 0,
            state: 1, // -1: ØªØ®Ø±ÛŒØ¨, 0: ÙÙ‚ÛŒØ±, 1: Ù…ØªÙˆØ³Ø·, 2: Ø®ÙˆØ¨, 3: Ø¹Ø§Ù„ÛŒ
            climate: 0,
            fire: 0,
            disease: 0,
            economic: 0
        };

        const STATE_NAMES = ['ğŸ’€ ØªØ®Ø±ÛŒØ¨ Ø³Ø±Ø²Ù…ÛŒÙ†', 'ÙÙ‚ÛŒØ±', 'Ù…ØªÙˆØ³Ø·', 'Ø®ÙˆØ¨', 'Ø¹Ø§Ù„ÛŒ'];
        const MAX_SCORE = 300;

        // Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ
        function initGame() {
            const rand = Math.random();
            if (rand < 0.10) {
                game.state = 3;
                game.score = 200;
            } else if (rand < 0.40) {
                game.state = 2;
                game.score = 100;
            } else if (rand < 0.70) {
                game.state = 1;
                game.score = 50;
            } else {
                game.state = 0;
                game.score = 20;
            }
            
            log('ğŸ® Ø¨Ø§Ø²ÛŒ Ø¨Ø§ ÙˆØ¶Ø¹ÛŒØª ' + STATE_NAMES[game.state + 1] + ' Ø¢ØºØ§Ø² Ø´Ø¯ (Ø§Ù…ØªÛŒØ§Ø²: ' + game.score + ')');
            updateDisplay();
            calculateScores();
        }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª ÙØ¹Ù„ÛŒ (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
        function calculateScores() {
            const grazing = parseInt(document.getElementById('grazing-intensity').value);
            const land = parseInt(document.getElementById('land-management').value);
            const bio = parseInt(document.getElementById('bio-management').value);
            const soil = parseInt(document.getElementById('soil-protection').value);
            const community = parseInt(document.getElementById('community-management').value);
            
            const positive = 3 + 
                Math.max(0, game.climate) +
                Math.max(0, grazing) + 
                Math.max(0, land) + 
                Math.max(0, bio) + 
                Math.max(0, soil) +
                Math.max(0, community);
            
            const negative = Math.min(0, game.climate) +
                Math.min(0, grazing) + 
                Math.min(0, land) + 
                Math.min(0, bio) +
                Math.min(0, soil) +
                Math.min(0, community) +
                game.fire + 
                game.disease +
                game.economic;
            
            const total = positive + negative;
            
            document.getElementById('positive-score').textContent = '+' + positive;
            document.getElementById('negative-score').textContent = negative;
            document.getElementById('total-score').textContent = (total >= 0 ? '+' : '') + total;
            document.getElementById('accumulated-score').textContent = game.score;
            
            updateScoreColor();
        }

        // Ø±Ù†Ú¯ Ø§Ù…ØªÛŒØ§Ø²
        function updateScoreColor() {
            const el = document.getElementById('accumulated-score');
            if (game.score >= 200) el.style.color = '#2ecc71';
            else if (game.score >= 100) el.style.color = '#a8e063';
            else if (game.score >= 50) el.style.color = '#f2c94c';
            else if (game.score >= -99) el.style.color = '#f45c43';
            else el.style.color = '#e74c3c';
            
            if (game.score >= MAX_SCORE) {
                el.textContent = game.score + ' (Ø­Ø¯Ø§Ú©Ø«Ø±)';
            }
        }

        // Ù¾ÛŒØ´Ø±ÙˆÛŒ Ø³Ø§Ù„
        function advanceYear() {
            game.year++;
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ ØªØµØ§Ø¯ÙÛŒ
            updateRandomEvents();
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù…ØªÛŒØ§Ø² Ø³Ø§Ù„
            const grazing = parseInt(document.getElementById('grazing-intensity').value);
            const land = parseInt(document.getElementById('land-management').value);
            const bio = parseInt(document.getElementById('bio-management').value);
            const soil = parseInt(document.getElementById('soil-protection').value);
            const community = parseInt(document.getElementById('community-management').value);
            
            const positive = 3 + 
                Math.max(0, game.climate) +
                Math.max(0, grazing) + 
                Math.max(0, land) + 
                Math.max(0, bio) + 
                Math.max(0, soil) +
                Math.max(0, community);
            
            const negative = Math.min(0, game.climate) +
                Math.min(0, grazing) + 
                Math.min(0, land) + 
                Math.min(0, bio) +
                Math.min(0, soil) +
                Math.min(0, community) +
                game.fire + 
                game.disease +
                game.economic;
            
            const yearScore = positive + negative;
            const oldScore = game.score;
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø§Ù…ØªÛŒØ§Ø² ØªØ¬Ù…Ø¹ÛŒ
            game.score = Math.min(game.score + yearScore, MAX_SCORE);
            
            log('Ø³Ø§Ù„ ' + game.year + ': Ø§Ù…ØªÛŒØ§Ø² ' + (yearScore >= 0 ? '+' : '') + yearScore + ' | Ú©Ù„: ' + oldScore + ' â†’ ' + game.score);
            
            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
            calculateScores();
            checkStateChange();
            updateDisplay();
        }

        // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ ØªØµØ§Ø¯ÙÛŒ
        function updateRandomEvents() {
            // Ø§Ù‚Ù„ÛŒÙ…
            const climateRand = Math.random();
            if (climateRand < 0.15) {
                game.climate = 5;
                document.getElementById('climate-status').textContent = 'ØªØ±Ø³Ø§Ù„ÛŒ (+5)';
            } else if (climateRand < 0.40) {
                game.climate = 2;
                document.getElementById('climate-status').textContent = 'Ù…Ø±Ø·ÙˆØ¨ (+2)';
            } else if (climateRand < 0.75) {
                game.climate = 0;
                document.getElementById('climate-status').textContent = 'Ù…ØªØ¹Ø§Ø¯Ù„ (0)';
            } else if (climateRand < 0.95) {
                game.climate = -3;
                document.getElementById('climate-status').textContent = 'Ø®Ø´Ú© (-3)';
            } else {
                game.climate = -5;
                document.getElementById('climate-status').textContent = 'Ø®Ø´Ú©Ø³Ø§Ù„ÛŒ (-5)';
            }
            
            // Ø¢ØªØ´
            if (Math.random() < 0.08) {
                game.fire = -7;
                document.getElementById('fire-status').textContent = 'Ø¯Ø§Ø±Ø¯ (-7)';
                log('ğŸ”¥ Ø¢ØªØ´â€ŒØ³ÙˆØ²ÛŒ Ø±Ø® Ø¯Ø§Ø¯!');
            } else {
                game.fire = 0;
                document.getElementById('fire-status').textContent = 'Ù†Ø¯Ø§Ø±Ø¯ (0)';
            }
            
            // Ø¨ÛŒÙ…Ø§Ø±ÛŒ
            if (Math.random() < 0.06) {
                game.disease = -4;
                document.getElementById('disease-status').textContent = 'Ø¯Ø§Ø±Ø¯ (-4)';
                log('ğŸ¦  Ø´ÛŒÙˆØ¹ Ø¨ÛŒÙ…Ø§Ø±ÛŒ!');
            } else {
                game.disease = 0;
                document.getElementById('disease-status').textContent = 'Ù†Ø¯Ø§Ø±Ø¯ (0)';
            }
            
            // Ø¨Ø­Ø±Ø§Ù† Ø§Ù‚ØªØµØ§Ø¯ÛŒ
            const econRand = Math.random();
            if (econRand < 0.50) {
                game.economic = 0;
                document.getElementById('economic-status').textContent = 'Ù†Ø¯Ø§Ø±Ø¯ (0)';
            } else if (econRand < 0.75) {
                game.economic = -2;
                document.getElementById('economic-status').textContent = 'Ø®ÙÛŒÙ (-2)';
            } else if (econRand < 0.90) {
                game.economic = -4;
                document.getElementById('economic-status').textContent = 'Ù…ØªÙˆØ³Ø· (-4)';
            } else {
                game.economic = -6;
                document.getElementById('economic-status').textContent = 'Ø´Ø¯ÛŒØ¯ (-6)';
            }
        }

        // Ú†Ú© ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª
        function checkStateChange() {
            let newState;
            
            if (game.score <= -100) {
                newState = -1;
            } else if (game.score <= 49) {
                newState = 0;
            } else if (game.score <= 99) {
                newState = 1;
            } else if (game.score <= 199) {
                newState = 2;
            } else {
                newState = 3;
            }
            
            if (newState !== game.state) {
                const oldName = STATE_NAMES[game.state + 1];
                const newName = STATE_NAMES[newState + 1];
                
                if (newState > game.state) {
                    log('âœ…âœ…âœ… Ø§Ø±ØªÙ‚Ø§ Ø§Ø² ' + oldName + ' Ø¨Ù‡ ' + newName + '!');
                } else {
                    log('âš ï¸âš ï¸âš ï¸ Ø§ÙÙˆÙ„ Ø§Ø² ' + oldName + ' Ø¨Ù‡ ' + newName + '!');
                }
                
                game.state = newState;
            }
        }

        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´
        function updateDisplay() {
            // Ø¨Ø§Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø­Ø§Ù„Øª
            document.querySelectorAll('.state-box').forEach(b => b.classList.remove('active'));
            const ids = ['state-destroyed', 'state-poor', 'state-moderate', 'state-good', 'state-excellent'];
            document.getElementById(ids[game.state + 1]).classList.add('active');
            
            // Ù…ØªÙ† Ø­Ø§Ù„Øª
            document.getElementById('current-state-text').textContent = STATE_NAMES[game.state + 1];
            
            // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ù†ØªÙ‚Ø§Ù„
            let info = 'Ø§Ù…ØªÛŒØ§Ø² ÙØ¹Ù„ÛŒ: ' + game.score;
            if (game.state < 3) {
                const thresholds = [50, 100, 200];
                const needed = thresholds[game.state] - game.score;
                info += ' | Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªÙ‚Ø§: +' + needed;
            }
            document.getElementById('transition-info').textContent = info;
            
            // Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª
            const percent = Math.max(0, Math.min(100, ((game.score + 100) / 400) * 100));
            document.getElementById('progress-fill').style.width = percent + '%';
            document.getElementById('progress-fill').textContent = STATE_NAMES[game.state + 1];
        }

        // Ù„Ø§Ú¯
        function log(msg) {
            const logEl = document.getElementById('event-log');
            const item = document.createElement('div');
            item.className = 'event-item';
            item.textContent = msg;
            logEl.insertBefore(item, logEl.firstChild);
            
            while (logEl.children.length > 10) {
                logEl.removeChild(logEl.lastChild);
            }
        }

        // Event listeners
        document.getElementById('advance-year').addEventListener('click', advanceYear);
        document.getElementById('grazing-intensity').addEventListener('change', calculateScores);
        document.getElementById('land-management').addEventListener('change', calculateScores);
        document.getElementById('bio-management').addEventListener('change', calculateScores);
        document.getElementById('soil-protection').addEventListener('change', calculateScores);
        document.getElementById('community-management').addEventListener('change', calculateScores);

        // Ø´Ø±ÙˆØ¹
        initGame();
    </script>
</body>
</html>